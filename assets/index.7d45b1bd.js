const ge=function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))p(_);new MutationObserver(_=>{for(const g of _)if(g.type==="childList")for(const h of g.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&p(h)}).observe(document,{childList:!0,subtree:!0});function S(_){const g={};return _.integrity&&(g.integrity=_.integrity),_.referrerpolicy&&(g.referrerPolicy=_.referrerpolicy),_.crossorigin==="use-credentials"?g.credentials="include":_.crossorigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function p(_){if(_.ep)return;_.ep=!0;const g=S(_);fetch(_.href,g)}};ge();(function L(x,S,p){function _(c,n){if(!S[c]){if(!x[c]){var i=typeof require=="function"&&require;if(!n&&i)return i(c,!0);if(g)return g(c,!0);throw(i=new Error("Cannot find module '"+c+"'")).code="MODULE_NOT_FOUND",i}i=S[c]={exports:{}},x[c][0].call(i.exports,function(f){return _(x[c][1][f]||f)},i,i.exports,L,x,S,p)}return S[c].exports}for(var g=typeof require=="function"&&require,h=0;h<p.length;h++)_(p[h]);return _})({1:[function(L,x,S){L=L("./lib/client"),x.exports={client:L,Client:L}},{"./lib/client":3}],2:[function(L,x,S){function p(c,n){var i,f=Object.keys(c);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(c),n&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(c,e).enumerable})),f.push.apply(f,i)),f}function _(c){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?p(Object(i),!0).forEach(function(f){var e,o;e=c,f=i[o=f],o in e?Object.defineProperty(e,o,{value:f,enumerable:!0,configurable:!0,writable:!0}):e[o]=f}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach(function(f){Object.defineProperty(c,f,Object.getOwnPropertyDescriptor(i,f))})}return c}var g=L("node-fetch"),h=L("./utils");x.exports=function(c,n){var i=c.url!==void 0?c.url:c.uri;if(h.isURL(i)||(i="https://api.twitch.tv/kraken".concat(i[0]==="/"?i:"/".concat(i))),h.isNode()){var f=Object.assign({method:"GET",json:!0},c);f.qs&&(e=new URLSearchParams(f.qs),i+="?".concat(e));var e={};"fetchAgent"in this.opts.connection&&(e.agent=this.opts.connection.fetchAgent);var e=g(i,_(_({},e),{},{method:f.method,headers:f.headers,body:f.body})),o={};e.then(function(s){return o={statusCode:s.status,headers:s.headers},f.json?s.json():s.text()}).then(function(s){return n(null,o,s)},function(s){return n(s,o,null)})}else{var r,a=Object.assign({method:"GET",headers:{}},c,{url:i}),l=new XMLHttpRequest;for(r in l.open(a.method,a.url,!0),a.headers)l.setRequestHeader(r,a.headers[r]);l.responseType="json",l.addEventListener("load",function(s){l.readyState===4&&(l.status!==200?n(l.status,null,null):n(null,null,l.response))}),l.send()}}},{"./utils":9,"node-fetch":10}],3:[function(L,x,S){(function(p){(function(){function _(t,d){var v,C=Object.keys(t);return Object.getOwnPropertySymbols&&(v=Object.getOwnPropertySymbols(t),d&&(v=v.filter(function(k){return Object.getOwnPropertyDescriptor(t,k).enumerable})),C.push.apply(C,v)),C}function g(t){for(var d=1;d<arguments.length;d++){var v=arguments[d]!=null?arguments[d]:{};d%2?_(Object(v),!0).forEach(function(C){var k,I;k=t,C=v[I=C],I in k?Object.defineProperty(k,I,{value:C,enumerable:!0,configurable:!0,writable:!0}):k[I]=C}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(v)):_(Object(v)).forEach(function(C){Object.defineProperty(t,C,Object.getOwnPropertyDescriptor(v,C))})}return t}function h(t){return function(d){if(Array.isArray(d))return c(d)}(t)||function(d){if(typeof Symbol!="undefined"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}(t)||function(d,v){if(d){if(typeof d=="string")return c(d,v);var C=Object.prototype.toString.call(d).slice(8,-1);return(C=C==="Object"&&d.constructor?d.constructor.name:C)==="Map"||C==="Set"?Array.from(d):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?c(d,v):void 0}}(t)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function c(t,d){(d==null||d>t.length)&&(d=t.length);for(var v=0,C=new Array(d);v<d;v++)C[v]=t[v];return C}function n(t){if(!(this instanceof n))return new n(t);this.opts=b.get(t,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=b.get(this.opts.options.clientId,null),this._globalDefaultChannel=b.channel(b.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=b.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=b.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=b.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=b.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=b.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=b.get(this.opts.connection.reconnect,!0),this.reconnectDecay=b.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=b.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=b.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null,t="error",this.opts.options.debug&&(t="info"),this.log=this.opts.logger||s;try{s.setLevel(t)}catch{}this.opts.channels.forEach(function(d,v,C){return C[v]=b.channel(d)}),l.call(this),this.setMaxListeners(0)}var i,f=p!==void 0?p:typeof window!="undefined"?window:{},e=f.WebSocket||L("ws"),o=f.fetch||L("node-fetch"),r=L("./api"),a=L("./commands"),l=L("./events").EventEmitter,s=L("./logger"),m=L("./parser"),w=L("./timer"),b=L("./utils"),$=!1;for(i in b.inherits(n,l),a)n.prototype[i]=a[i];n.prototype.emits=function(t,d){for(var v=0;v<t.length;v++){var C=v<d.length?d[v]:d[d.length-1];this.emit.apply(this,[t[v]].concat(C))}},n.prototype.api=function(){$||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),$=!0),r.apply(void 0,arguments)},n.prototype.handleMessage=function(t){var d=this;if(t){this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(t)),t);var v,C,k,I,j,N,P,z,U,u=b.channel(b.get(t.params[0],null)),y=b.get(t.params[1],null),M=b.get(t.tags["msg-id"],null),T=t.tags=m.badges(m.badgeInfo(m.emotes(t.tags)));for(v in T)v!=="emote-sets"&&v!=="ban-duration"&&v!=="bits"&&(typeof(C=T[v])=="boolean"?C=null:C==="1"?C=!0:C==="0"?C=!1:typeof C=="string"&&(C=b.unescapeIRC(C)),T[v]=C);if(t.prefix===null)switch(t.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":var fe=new Date;this.currentLatency=(fe.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn(`Could not parse message with no prefix:
`.concat(JSON.stringify(t,null,4)))}else if(t.prefix==="tmi.twitch.tv")switch(t.command){case"002":case"003":case"004":case"372":case"375":case"CAP":break;case"001":this.username=t.params[0];break;case"376":this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(function(){d._isConnected()&&d.ws.send("PING"),d.latency=new Date,d.pingTimeout=setTimeout(function(){d.ws!==null&&(d.wasCloseCalled=!1,d.log.error("Ping timeout."),d.ws.close(),clearInterval(d.pingLoop),clearTimeout(d.pingTimeout),clearTimeout(d._updateEmotesetsTimer))},b.get(d.opts.connection.timeout,9999))},6e4);var K=b.get(this.opts.options.joinInterval,2e3),ae=new w(K=K<300?300:K),ce=h(new Set([].concat(h(this.opts.channels),h(this.channels))));this.channels=[];for(var oe=0;oe<ce.length;oe++)(function(A){var de=ce[A];ae.add(function(){d._isConnected()&&d.join(de).catch(function(pe){return d.log.error(pe)})})})(oe);ae.next();break;case"NOTICE":var V=[null],J=[u,M,y],X=[u,!0],Y=[u,!1],D=[J,V],E=[J,[M]],O="[".concat(u,"] ").concat(y);switch(M){case"subs_on":this.log.info("[".concat(u,"] This room is now in subscribers-only mode.")),this.emits(["subscriber","subscribers","_promiseSubscribers"],[X,X,V]);break;case"subs_off":this.log.info("[".concat(u,"] This room is no longer in subscribers-only mode.")),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[Y,Y,V]);break;case"emote_only_on":this.log.info("[".concat(u,"] This room is now in emote-only mode.")),this.emits(["emoteonly","_promiseEmoteonly"],[X,V]);break;case"emote_only_off":this.log.info("[".concat(u,"] This room is no longer in emote-only mode.")),this.emits(["emoteonly","_promiseEmoteonlyoff"],[Y,V]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info("[".concat(u,"] This room is now in r9k mode.")),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[X,X,V]);break;case"r9k_off":this.log.info("[".concat(u,"] This room is no longer in r9k mode.")),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[Y,Y,V]);break;case"room_mods":var Z=y.split(": "),Z=(1<Z.length?Z[1]:"").toLowerCase().split(", ").filter(function(A){return A});this.emits(["_promiseMods","mods"],[[null,Z],[u,Z]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[u,[]]]);break;case"vips_success":var G=(y=y.endsWith(".")?y.slice(0,-1):y).split(": "),G=(1<G.length?G[1]:"").toLowerCase().split(", ").filter(function(A){return A});this.emits(["_promiseVips","vips"],[[null,G],[u,G]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[u,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(O),this.emits(["notice","_promiseBan"],E);break;case"ban_success":this.log.info(O),this.emits(["notice","_promiseBan"],D);break;case"usage_clear":this.log.info(O),this.emits(["notice","_promiseClear"],E);break;case"usage_mods":this.log.info(O),this.emits(["notice","_promiseMods"],[J,[M,[]]]);break;case"mod_success":this.log.info(O),this.emits(["notice","_promiseMod"],D);break;case"usage_vips":this.log.info(O),this.emits(["notice","_promiseVips"],[J,[M,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(O),this.emits(["notice","_promiseVip"],[J,[M,[]]]);break;case"vip_success":this.log.info(O),this.emits(["notice","_promiseVip"],D);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(O),this.emits(["notice","_promiseMod"],E);break;case"unmod_success":this.log.info(O),this.emits(["notice","_promiseUnmod"],D);break;case"unvip_success":this.log.info(O),this.emits(["notice","_promiseUnvip"],D);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(O),this.emits(["notice","_promiseUnmod"],E);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(O),this.emits(["notice","_promiseUnvip"],E);break;case"color_changed":this.log.info(O),this.emits(["notice","_promiseColor"],D);break;case"usage_color":case"turbo_only_color":this.log.info(O),this.emits(["notice","_promiseColor"],E);break;case"commercial_success":this.log.info(O),this.emits(["notice","_promiseCommercial"],D);break;case"usage_commercial":case"bad_commercial_error":this.log.info(O),this.emits(["notice","_promiseCommercial"],E);break;case"hosts_remaining":this.log.info(O),G=isNaN(y[0])?0:parseInt(y[0]),this.emits(["notice","_promiseHost"],[J,[null,~~G]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(O),this.emits(["notice","_promiseHost"],[J,[M,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(O),this.emits(["notice","_promiseR9kbeta"],E);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(O),this.emits(["notice","_promiseR9kbetaoff"],E);break;case"timeout_success":this.log.info(O),this.emits(["notice","_promiseTimeout"],D);break;case"delete_message_success":this.log.info("[".concat(u," ").concat(y,"]")),this.emits(["notice","_promiseDeletemessage"],D);break;case"already_subs_off":case"usage_subs_off":this.log.info(O),this.emits(["notice","_promiseSubscribersoff"],E);break;case"already_subs_on":case"usage_subs_on":this.log.info(O),this.emits(["notice","_promiseSubscribers"],E);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(O),this.emits(["notice","_promiseEmoteonlyoff"],E);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(O),this.emits(["notice","_promiseEmoteonly"],E);break;case"usage_slow_on":this.log.info(O),this.emits(["notice","_promiseSlow"],E);break;case"usage_slow_off":this.log.info(O),this.emits(["notice","_promiseSlowoff"],E);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(O),this.emits(["notice","_promiseTimeout"],E);break;case"untimeout_success":case"unban_success":this.log.info(O),this.emits(["notice","_promiseUnban"],D);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(O),this.emits(["notice","_promiseUnban"],E);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(O),this.emits(["notice","_promiseDeletemessage"],E);break;case"usage_unhost":case"not_hosting":this.log.info(O),this.emits(["notice","_promiseUnhost"],E);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(O),this.emits(["notice","_promiseWhisper"],E);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(O),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[J,[M,u]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(O),this.emit("automod",u,M,y);break;case"unrecognized_cmd":this.log.info(O),this.emit("notice",u,M,y);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(O),this.emit("notice",u,M,y);break;case"host_on":case"host_off":break;default:y.includes("Login unsuccessful")||y.includes("Login authentication failed")||y.includes("Error logging in")||y.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=y,this.log.error(this.reason),this.ws.close()):y.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
`.concat(JSON.stringify(t,null,4))),this.emit("notice",u,M,y))}break;case"USERNOTICE":var H=T["display-name"]||T.login,K=T["msg-param-sub-plan"]||"",Q=b.unescapeIRC(b.get(T["msg-param-sub-plan-name"],""))||null,B={prime:K.includes("Prime"),plan:K,planName:Q},ie=~~(T["msg-param-streak-months"]||0),le=T["msg-param-recipient-display-name"]||T["msg-param-recipient-user-name"],ue=~~T["msg-param-mass-gift-count"];switch(T["message-type"]=M){case"resub":this.emits(["resub","subanniversary"],[[u,H,ie,y,T,B]]);break;case"sub":this.emits(["subscription","sub"],[[u,H,B,y,T]]);break;case"subgift":this.emit("subgift",u,H,ie,le,B,T);break;case"anonsubgift":this.emit("anonsubgift",u,ie,le,B,T);break;case"submysterygift":this.emit("submysterygift",u,H,ue,B,T);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",u,ue,B,T);break;case"primepaidupgrade":this.emit("primepaidupgrade",u,H,B,T);break;case"giftpaidupgrade":var re=T["msg-param-sender-name"]||T["msg-param-sender-login"];this.emit("giftpaidupgrade",u,H,re,T);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",u,H,T);break;case"raid":var re=T["msg-param-displayName"]||T["msg-param-login"],te=+T["msg-param-viewerCount"];this.emit("raided",u,re,te,T);break;case"ritual":te=T["msg-param-ritual-name"],te==="new_chatter"?this.emit("newchatter",u,H,T,y):this.emit("ritual",te,u,H,T,y);break;default:this.emit("usernotice",M,u,T,y)}break;case"HOSTTARGET":var Q=y.split(" "),ee=~~Q[1]||0;Q[0]==="-"?(this.log.info("[".concat(u,"] Exited host mode.")),this.emits(["unhost","_promiseUnhost"],[[u,ee],[null]])):(this.log.info("[".concat(u,"] Now hosting ").concat(Q[0]," for ").concat(ee," viewer(s).")),this.emit("hosting",u,Q[0],ee));break;case"CLEARCHAT":1<t.params.length?(k=b.get(t.tags["ban-duration"],null))===null?(this.log.info("[".concat(u,"] ").concat(y," has been banned.")),this.emit("ban",u,y,null,t.tags)):(this.log.info("[".concat(u,"] ").concat(y," has been timed out for ").concat(k," seconds.")),this.emit("timeout",u,y,null,~~k,t.tags)):(this.log.info("[".concat(u,"] Chat was cleared by a moderator.")),this.emits(["clearchat","_promiseClear"],[[u],[null]]));break;case"CLEARMSG":1<t.params.length&&(ee=y,k=T.login,T["message-type"]="messagedeleted",this.log.info("[".concat(u,"] ").concat(k,"'s message has been deleted.")),this.emit("messagedeleted",u,k,ee,T));break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info("Disconnecting and reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.disconnect().catch(function(A){return d.log.error(A)}),setTimeout(function(){return d.connect().catch(function(A){return d.log.error(A)})},this.reconnectTimer);break;case"USERSTATE":t.tags.username=this.username,t.tags["user-type"]==="mod"&&(this.moderators[u]||(this.moderators[u]=[]),this.moderators[u].includes(this.username)||this.moderators[u].push(this.username)),b.isJustinfan(this.getUsername())||this.userstate[u]||(this.userstate[u]=T,this.lastJoined=u,this.channels.push(u),this.log.info("Joined ".concat(u)),this.emit("join",u,b.username(this.getUsername()),!0)),t.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(t.tags["emote-sets"]),this.userstate[u]=T;break;case"GLOBALUSERSTATE":this.globaluserstate=T,this.emit("globaluserstate",T),t.tags["emote-sets"]!==void 0&&this._updateEmoteset(t.tags["emote-sets"]);break;case"ROOMSTATE":b.channel(this.lastJoined)===u&&this.emit("_promiseJoin",null,u),t.tags.channel=u,this.emit("roomstate",u,t.tags),b.hasOwn(t.tags,"subs-only")||(b.hasOwn(t.tags,"slow")&&(typeof t.tags.slow!="boolean"||t.tags.slow?(I=[u,!0,~~t.tags.slow],this.log.info("[".concat(u,"] This room is now in slow mode.")),this.emits(["slow","slowmode","_promiseSlow"],[I,I,[null]])):(I=[u,!1,0],this.log.info("[".concat(u,"] This room is no longer in slow mode.")),this.emits(["slow","slowmode","_promiseSlowoff"],[I,I,[null]]))),b.hasOwn(t.tags,"followers-only")&&(t.tags["followers-only"]==="-1"?(j=[u,!1,0],this.log.info("[".concat(u,"] This room is no longer in followers-only mode.")),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[j,j,[null]])):(j=[u,!0,~~t.tags["followers-only"]],this.log.info("[".concat(u,"] This room is now in follower-only mode.")),this.emits(["followersonly","followersmode","_promiseFollowers"],[j,j,[null]]))));break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
`.concat(JSON.stringify(t,null,4)))}else if(t.prefix==="jtv")t.command==="MODE"?y==="+o"?(this.moderators[u]||(this.moderators[u]=[]),this.moderators[u].includes(t.params[2])||this.moderators[u].push(t.params[2]),this.emit("mod",u,t.params[2])):y==="-o"&&(this.moderators[u]||(this.moderators[u]=[]),this.moderators[u].filter(function(A){return A!==t.params[2]}),this.emit("unmod",u,t.params[2])):this.log.warn(`Could not parse message from jtv:
`.concat(JSON.stringify(t,null,4)));else switch(t.command){case"353":this.emit("names",t.params[2],t.params[3].split(" "));break;case"366":break;case"JOIN":var W=t.prefix.split("!")[0];b.isJustinfan(this.getUsername())&&this.username===W&&(this.lastJoined=u,this.channels.push(u),this.log.info("Joined ".concat(u)),this.emit("join",u,W,!0)),this.username!==W&&this.emit("join",u,W,!1);break;case"PART":var F=!1,me=t.prefix.split("!")[0];this.username===me&&(F=!0,this.userstate[u]&&delete this.userstate[u],(W=this.channels.indexOf(u))!==-1&&this.channels.splice(W,1),(W=this.opts.channels.indexOf(u))!==-1&&this.opts.channels.splice(W,1),this.log.info("Left ".concat(u)),this.emit("_promisePart",null)),this.emit("part",u,me,F);break;case"WHISPER":F=t.prefix.split("!")[0],this.log.info("[WHISPER] <".concat(F,">: ").concat(y)),b.hasOwn(t.tags,"username")||(t.tags.username=F),t.tags["message-type"]="whisper",F=b.channel(t.tags.username),this.emits(["whisper","message"],[[F,t.tags,y,!1]]);break;case"PRIVMSG":t.tags.username=t.prefix.split("!")[0],t.tags.username==="jtv"?(P=b.username(y.split(" ")[0]),z=y.includes("auto"),y.includes("hosting you for")?(N=b.extractNumber(y),this.emit("hosted",u,P,N,z)):y.includes("hosting you")&&this.emit("hosted",u,P,0,z)):(N=b.get(this.opts.options.messagesLogLevel,"info"),P=b.actionMessage(y),t.tags["message-type"]=P?"action":"chat",y=P?P[1]:y,b.hasOwn(t.tags,"bits")?this.emit("cheer",u,t.tags,y):(b.hasOwn(t.tags,"msg-id")?t.tags["msg-id"]==="highlighted-message"?(z=t.tags["msg-id"],this.emit("redeem",u,t.tags.username,z,t.tags,y)):t.tags["msg-id"]==="skip-subs-mode-message"&&(U=t.tags["msg-id"],this.emit("redeem",u,t.tags.username,U,t.tags,y)):b.hasOwn(t.tags,"custom-reward-id")&&(U=t.tags["custom-reward-id"],this.emit("redeem",u,t.tags.username,U,t.tags,y)),P?(this.log[N]("[".concat(u,"] *<").concat(t.tags.username,">: ").concat(y)),this.emits(["action","message"],[[u,t.tags,y,!1]])):(this.log[N]("[".concat(u,"] <").concat(t.tags.username,">: ").concat(y)),this.emits(["chat","message"],[[u,t.tags,y,!1]]))));break;default:this.log.warn(`Could not parse message:
`.concat(JSON.stringify(t,null,4)))}}},n.prototype.connect=function(){var t=this;return new Promise(function(d,v){t.server=b.get(t.opts.connection.server,"irc-ws.chat.twitch.tv"),t.port=b.get(t.opts.connection.port,80),t.secure&&(t.port=443),t.port===443&&(t.secure=!0),t.reconnectTimer=t.reconnectTimer*t.reconnectDecay,t.reconnectTimer>=t.maxReconnectInterval&&(t.reconnectTimer=t.maxReconnectInterval),t._openConnection(),t.once("_promiseConnect",function(C){C?v(C):d([t.server,~~t.port])})})},n.prototype._openConnection=function(){var t="".concat(this.secure?"wss":"ws","://").concat(this.server,":").concat(this.port,"/"),d={};"agent"in this.opts.connection&&(d.agent=this.opts.connection.agent),this.ws=new e(t,"irc",d),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},n.prototype._onOpen=function(){var t=this;this._isConnected()&&(this.log.info("Connecting to ".concat(this.server," on port ").concat(this.port,"..")),this.emit("connecting",this.server,~~this.port),this.username=b.get(this.opts.identity.username,b.justinfan()),this._getToken().then(function(d){var v=b.password(d);t.log.info("Sending authentication to server.."),t.emit("logon"),d="twitch.tv/tags twitch.tv/commands",t._skipMembership||(d+=" twitch.tv/membership"),t.ws.send("CAP REQ :"+d),v?t.ws.send("PASS ".concat(v)):b.isJustinfan(t.username)&&t.ws.send("PASS SCHMOOPIIE"),t.ws.send("NICK ".concat(t.username))}).catch(function(d){t.emits(["_promiseConnect","disconnected"],[[d],["Could not get a token."]])}))},n.prototype._getToken=function(){var t,d=this.opts.identity.password;return typeof d=="function"?(t=d())instanceof Promise?t:Promise.resolve(t):Promise.resolve(d)},n.prototype._onMessage=function(t){var d=this;t.data.trim().split(`\r
`).forEach(function(v){v=m.msg(v),v&&d.handleMessage(v)})},n.prototype._onError=function(){var t=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=this.ws===null?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.emit("reconnect"),setTimeout(function(){t.reconnecting=!1,t.connect().catch(function(d){return t.log.error(d)})},this.reconnectTimer)),this.ws=null},n.prototype._onClose=function(){var t=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Could not connect to server. Reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.emit("reconnect"),setTimeout(function(){t.reconnecting=!1,t.connect().catch(function(d){return t.log.error(d)})},this.reconnectTimer))),this.ws=null},n.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},n.prototype._sendCommand=function(t,d,v,C){var k=this;return new Promise(function(I,j){if(!k._isConnected())return j("Not connected to server.");var N;t!==null&&typeof t!="number"||(t===null&&(t=k._getPromiseDelay()),b.promiseDelay(t).then(function(){return j("No response from Twitch.")})),d!==null?(N=b.channel(d),k.log.info("[".concat(N,"] Executing command: ").concat(v)),k.ws.send("PRIVMSG ".concat(N," :").concat(v))):(k.log.info("Executing command: ".concat(v)),k.ws.send(v)),typeof C=="function"?C(I,j):I()})},n.prototype._sendMessage=function(t,d,v,C){var k=this;return new Promise(function(I,j){if(!k._isConnected())return j("Not connected to server.");if(b.isJustinfan(k.getUsername()))return j("Cannot send anonymous messages.");var N,P=b.channel(d);k.userstate[P]||(k.userstate[P]={}),500<=v.length&&(N=b.splitLine(v,500),v=N[0],setTimeout(function(){k._sendMessage(t,d,N[1],function(){})},350)),k.ws.send("PRIVMSG ".concat(P," :").concat(v));var z={};Object.keys(k.emotesets).forEach(function(M){return k.emotesets[M].forEach(function(T){return(b.isRegex(T.code)?m.emoteRegex:m.emoteString)(v,T.code,T.id,z)})});var U=Object.assign(k.userstate[P],m.emotes({emotes:m.transformEmotes(z)||null})),u=b.get(k.opts.options.messagesLogLevel,"info"),y=b.actionMessage(v);y?(U["message-type"]="action",k.log[u]("[".concat(P,"] *<").concat(k.getUsername(),">: ").concat(y[1])),k.emits(["action","message"],[[P,U,y[1],!0]])):(U["message-type"]="chat",k.log[u]("[".concat(P,"] <").concat(k.getUsername(),">: ").concat(v)),k.emits(["chat","message"],[[P,U,v,!0]])),typeof C=="function"?C(I,j):I()})},n.prototype._updateEmoteset=function(t){var d,v=this,C=t!==void 0;C&&(t===this.emotes?C=!1:this.emotes=t),this._skipUpdatingEmotesets?C&&this.emit("emotesets",t,{}):(d=function(){0<v._updateEmotesetsTimerDelay&&(clearTimeout(v._updateEmotesetsTimer),v._updateEmotesetsTimer=setTimeout(function(){return v._updateEmoteset(t)},v._updateEmotesetsTimerDelay))},this._getToken().then(function(k){var I="https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=".concat(t),j={};return"fetchAgent"in v.opts.connection&&(j.agent=v.opts.connection.fetchAgent),o(I,g(g({},j),{},{headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:"OAuth ".concat(b.token(k)),"Client-ID":v.clientId}}))}).then(function(k){return k.json()}).then(function(k){v.emotesets=k.emoticon_sets||{},v.emit("emotesets",t,v.emotesets),d()}).catch(d))},n.prototype.getUsername=function(){return this.username},n.prototype.getOptions=function(){return this.opts},n.prototype.getChannels=function(){return this.channels},n.prototype.isMod=function(t,d){return t=b.channel(t),this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].includes(b.username(d))},n.prototype.readyState=function(){return this.ws===null?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},n.prototype._isConnected=function(){return this.ws!==null&&this.ws.readyState===1},n.prototype.disconnect=function(){var t=this;return new Promise(function(d,v){t.ws!==null&&t.ws.readyState!==3?(t.wasCloseCalled=!0,t.log.info("Disconnecting from server.."),t.ws.close(),t.once("_promiseDisconnect",function(){return d([t.server,~~t.port])})):(t.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),v("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},n.prototype.off=n.prototype.removeListener,x!==void 0&&x.exports&&(x.exports=n),typeof window!="undefined"&&(window.tmi={client:n,Client:n})}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./api":2,"./commands":4,"./events":5,"./logger":6,"./parser":7,"./timer":8,"./utils":9,"node-fetch":10,ws:10}],4:[function(L,x,S){var p=L("./utils");function _(e,o){var r=this;return e=p.channel(e),o=p.get(o,30),this._sendCommand(null,e,"/followers ".concat(o),function(a,l){r.once("_promiseFollowers",function(s){s?l(s):a([e,~~o])})})}function g(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/followersoff",function(r,a){o.once("_promiseFollowersoff",function(l){l?a(l):r([e])})})}function h(e){var o=this;return e=p.channel(e),this._sendCommand(null,null,"PART ".concat(e),function(r,a){o.once("_promisePart",function(l){l?a(l):r([e])})})}function c(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/r9kbeta",function(r,a){o.once("_promiseR9kbeta",function(l){l?a(l):r([e])})})}function n(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/r9kbetaoff",function(r,a){o.once("_promiseR9kbetaoff",function(l){l?a(l):r([e])})})}function i(e,o){var r=this;return e=p.channel(e),o=p.get(o,300),this._sendCommand(null,e,"/slow ".concat(o),function(a,l){r.once("_promiseSlow",function(s){s?l(s):a([e,~~o])})})}function f(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/slowoff",function(r,a){o.once("_promiseSlowoff",function(l){l?a(l):r([e])})})}x.exports={action:function(e,o){return e=p.channel(e),o="ACTION ".concat(o,""),this._sendMessage(this._getPromiseDelay(),e,o,function(r,a){r([e,o])})},ban:function(e,o,r){var a=this;return e=p.channel(e),o=p.username(o),r=p.get(r,""),this._sendCommand(null,e,"/ban ".concat(o," ").concat(r),function(l,s){a.once("_promiseBan",function(m){m?s(m):l([e,o,r])})})},clear:function(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/clear",function(r,a){o.once("_promiseClear",function(l){l?a(l):r([e])})})},color:function(e,o){var r=this;return o=p.get(o,e),this._sendCommand(null,"#tmijs","/color ".concat(o),function(a,l){r.once("_promiseColor",function(s){s?l(s):a([o])})})},commercial:function(e,o){var r=this;return e=p.channel(e),o=p.get(o,30),this._sendCommand(null,e,"/commercial ".concat(o),function(a,l){r.once("_promiseCommercial",function(s){s?l(s):a([e,~~o])})})},deletemessage:function(e,o){var r=this;return e=p.channel(e),this._sendCommand(null,e,"/delete ".concat(o),function(a,l){r.once("_promiseDeletemessage",function(s){s?l(s):a([e])})})},emoteonly:function(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/emoteonly",function(r,a){o.once("_promiseEmoteonly",function(l){l?a(l):r([e])})})},emoteonlyoff:function(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/emoteonlyoff",function(r,a){o.once("_promiseEmoteonlyoff",function(l){l?a(l):r([e])})})},followersonly:_,followersmode:_,followersonlyoff:g,followersmodeoff:g,host:function(e,o){var r=this;return e=p.channel(e),o=p.username(o),this._sendCommand(2e3,e,"/host ".concat(o),function(a,l){r.once("_promiseHost",function(s,m){s?l(s):a([e,o,~~m])})})},join:function(e){var o=this;return e=p.channel(e),this._sendCommand(void 0,null,"JOIN ".concat(e),function(r,a){var l="_promiseJoin",s=!1,m=function w(b,$){e===p.channel($)&&(o.removeListener(l,w),s=!0,b?a(b):r([e]))};o.on(l,m),m=o._getPromiseDelay(),p.promiseDelay(m).then(function(){s||o.emit(l,"No response from Twitch.",e)})})},mod:function(e,o){var r=this;return e=p.channel(e),o=p.username(o),this._sendCommand(null,e,"/mod ".concat(o),function(a,l){r.once("_promiseMod",function(s){s?l(s):a([e,o])})})},mods:function(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/mods",function(r,a){o.once("_promiseMods",function(l,s){l?a(l):(s.forEach(function(m){o.moderators[e]||(o.moderators[e]=[]),o.moderators[e].includes(m)||o.moderators[e].push(m)}),r(s))})})},part:h,leave:h,ping:function(){var e=this;return this._sendCommand(null,null,"PING",function(o,r){e.latency=new Date,e.pingTimeout=setTimeout(function(){e.ws!==null&&(e.wasCloseCalled=!1,e.log.error("Ping timeout."),e.ws.close(),clearInterval(e.pingLoop),clearTimeout(e.pingTimeout))},p.get(e.opts.connection.timeout,9999)),e.once("_promisePing",function(a){return o([parseFloat(a)])})})},r9kbeta:c,r9kmode:c,r9kbetaoff:n,r9kmodeoff:n,raw:function(e){return this._sendCommand(null,null,e,function(o,r){o([e])})},say:function(e,o){return e=p.channel(e),o.startsWith(".")&&!o.startsWith("..")||o.startsWith("/")||o.startsWith("\\")?o.substr(1,3)==="me "?this.action(e,o.substr(4)):this._sendCommand(null,e,o,function(r,a){r([e,o])}):this._sendMessage(this._getPromiseDelay(),e,o,function(r,a){r([e,o])})},slow:i,slowmode:i,slowoff:f,slowmodeoff:f,subscribers:function(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/subscribers",function(r,a){o.once("_promiseSubscribers",function(l){l?a(l):r([e])})})},subscribersoff:function(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/subscribersoff",function(r,a){o.once("_promiseSubscribersoff",function(l){l?a(l):r([e])})})},timeout:function(e,o,r,a){var l=this;return e=p.channel(e),o=p.username(o),r===null||p.isInteger(r)||(a=r,r=300),r=p.get(r,300),a=p.get(a,""),this._sendCommand(null,e,"/timeout ".concat(o," ").concat(r," ").concat(a),function(s,m){l.once("_promiseTimeout",function(w){w?m(w):s([e,o,~~r,a])})})},unban:function(e,o){var r=this;return e=p.channel(e),o=p.username(o),this._sendCommand(null,e,"/unban ".concat(o),function(a,l){r.once("_promiseUnban",function(s){s?l(s):a([e,o])})})},unhost:function(e){var o=this;return e=p.channel(e),this._sendCommand(2e3,e,"/unhost",function(r,a){o.once("_promiseUnhost",function(l){l?a(l):r([e])})})},unmod:function(e,o){var r=this;return e=p.channel(e),o=p.username(o),this._sendCommand(null,e,"/unmod ".concat(o),function(a,l){r.once("_promiseUnmod",function(s){s?l(s):a([e,o])})})},unvip:function(e,o){var r=this;return e=p.channel(e),o=p.username(o),this._sendCommand(null,e,"/unvip ".concat(o),function(a,l){r.once("_promiseUnvip",function(s){s?l(s):a([e,o])})})},vip:function(e,o){var r=this;return e=p.channel(e),o=p.username(o),this._sendCommand(null,e,"/vip ".concat(o),function(a,l){r.once("_promiseVip",function(s){s?l(s):a([e,o])})})},vips:function(e){var o=this;return e=p.channel(e),this._sendCommand(null,e,"/vips",function(r,a){o.once("_promiseVips",function(l,s){l?a(l):r(s)})})},whisper:function(e,o){var r=this;return(e=p.username(e))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs","/w ".concat(e," ").concat(o),function(a,l){r.once("_promiseWhisper",function(s){s&&l(s)})}).catch(function(s){if(s&&typeof s=="string"&&s.indexOf("No response from Twitch.")!==0)throw s;var l=p.channel(e),s=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:r.getUsername()},r.globaluserstate);return r.emits(["whisper","message"],[[l,s,o,!0],[l,s,o,!0]]),[e,o]})}}},{"./utils":9}],5:[function(L,x,S){function p(n){return(p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(n)}function _(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function g(n){return typeof n=="function"}function h(n){return p(n)==="object"&&n!==null}function c(n){return n===void 0}((x.exports=_).EventEmitter=_).prototype._events=void 0,_.prototype._maxListeners=void 0,_.defaultMaxListeners=10,_.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},_.prototype.emit=function(n){var i,f,e,o,r,a;if(this._events||(this._events={}),n==="error"&&(!this._events.error||h(this._events.error)&&!this._events.error.length))throw(i=arguments[1])instanceof Error?i:TypeError('Uncaught, unspecified "error" event.');if(c(f=this._events[n]))return!1;if(g(f))switch(arguments.length){case 1:f.call(this);break;case 2:f.call(this,arguments[1]);break;case 3:f.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),f.apply(this,o)}else if(h(f))for(o=Array.prototype.slice.call(arguments,1),e=(a=f.slice()).length,r=0;r<e;r++)a[r].apply(this,o);return!0},_.prototype.on=_.prototype.addListener=function(n,i){var f;if(!g(i))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",n,g(i.listener)?i.listener:i),this._events[n]?h(this._events[n])?this._events[n].push(i):this._events[n]=[this._events[n],i]:this._events[n]=i,h(this._events[n])&&!this._events[n].warned&&(f=c(this._maxListeners)?_.defaultMaxListeners:this._maxListeners)&&0<f&&this._events[n].length>f&&(this._events[n].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[n].length),typeof console.trace=="function"&&console.trace()),this},_.prototype.once=function(n,i){if(!g(i))throw TypeError("listener must be a function");var f=!1;if(this._events.hasOwnProperty(n)&&n.charAt(0)==="_"){var e,o=1,r=n;for(e in this._events)this._events.hasOwnProperty(e)&&e.startsWith(r)&&o++;n+=o}function a(){n.charAt(0)!=="_"||isNaN(n.substr(n.length-1))||(n=n.substring(0,n.length-1)),this.removeListener(n,a),f||(f=!0,i.apply(this,arguments))}return a.listener=i,this.on(n,a),this},_.prototype.removeListener=function(n,i){var f,e,o,r;if(!g(i))throw TypeError("listener must be a function");if(!this._events||!this._events[n])return this;if(o=(f=this._events[n]).length,e=-1,f===i||g(f.listener)&&f.listener===i){if(delete this._events[n],this._events.hasOwnProperty(n+"2")&&n.charAt(0)==="_"){var a,l=n;for(a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(l)&&(isNaN(parseInt(a.substr(a.length-1)))||(this._events[n+parseInt(a.substr(a.length-1)-1)]=this._events[a],delete this._events[a]));this._events[n]=this._events[n+"1"],delete this._events[n+"1"]}this._events.removeListener&&this.emit("removeListener",n,i)}else if(h(f)){for(r=o;0<r--;)if(f[r]===i||f[r].listener&&f[r].listener===i){e=r;break}if(e<0)return this;f.length===1?(f.length=0,delete this._events[n]):f.splice(e,1),this._events.removeListener&&this.emit("removeListener",n,i)}return this},_.prototype.removeAllListeners=function(n){var i,f;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[n]&&delete this._events[n],this;if(arguments.length===0){for(i in this._events)i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events={},this}if(g(f=this._events[n]))this.removeListener(n,f);else if(f)for(;f.length;)this.removeListener(n,f[f.length-1]);return delete this._events[n],this},_.prototype.listeners=function(n){return n=this._events&&this._events[n]?g(this._events[n])?[this._events[n]]:this._events[n].slice():[],n},_.prototype.listenerCount=function(n){if(this._events){if(n=this._events[n],g(n))return 1;if(n)return n.length}return 0},_.listenerCount=function(n,i){return n.listenerCount(i)}},{}],6:[function(L,x,S){var p=L("./utils"),_="info",g={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function h(c){return function(n){g[_]<=g[c]&&console.log("[".concat(p.formatDate(new Date),"] ").concat(c,": ").concat(n))}}x.exports={setLevel:function(c){_=c},trace:h("trace"),debug:h("debug"),info:h("info"),warn:h("warn"),error:h("error"),fatal:h("fatal")}},{"./utils":9}],7:[function(L,x,S){var p=L("./utils"),_=/\S+/g;function g(h,c,e,a,f){var e=2<arguments.length&&e!==void 0?e:",",o=3<arguments.length&&a!==void 0?a:"/",r=4<arguments.length?f:void 0,a=h[c];if(a===void 0)return h;if(f=typeof a=="string",h[c+"-raw"]=f?a:null,a===!0)return h[c]=null,h;if(h[c]={},f)for(var l=a.split(e),s=0;s<l.length;s++){var m=l[s].split(o),w=m[1];r!==void 0&&w&&(w=w.split(r)),h[c][m[0]]=w||null}return h}x.exports={badges:function(h){return g(h,"badges")},badgeInfo:function(h){return g(h,"badge-info")},emotes:function(h){return g(h,"emotes","/",":",",")},emoteRegex:function(h,c,n,i){_.lastIndex=0;for(var f,e=new RegExp("(\\b|^|\\s)"+p.unescapeHtml(c)+"(\\b|$|\\s)");(f=_.exec(h))!==null;)e.test(f[0])&&(i[n]=i[n]||[],i[n].push([f.index,_.lastIndex-1]))},emoteString:function(h,c,n,i){var f;for(_.lastIndex=0;(f=_.exec(h))!==null;)f[0]===p.unescapeHtml(c)&&(i[n]=i[n]||[],i[n].push([f.index,_.lastIndex-1]))},transformEmotes:function(h){var c="";return Object.keys(h).forEach(function(n){c="".concat(c+n,":"),h[n].forEach(function(i){return c="".concat(c+i.join("-"),",")}),c="".concat(c.slice(0,-1),"/")}),c.slice(0,-1)},formTags:function(h){var c,n=[];for(c in h){var i=p.escapeIRC(h[c]);n.push("".concat(c,"=").concat(i))}return"@".concat(n.join(";"))},msg:function(h){var c={raw:h,tags:{},prefix:null,command:null,params:[]},n=0,i=0;if(h.charCodeAt(0)===64){if((i=h.indexOf(" "))===-1)return null;for(var f=h.slice(1,i).split(";"),e=0;e<f.length;e++){var o=f[e],r=o.split("=");c.tags[r[0]]=o.substring(o.indexOf("=")+1)||!0}n=i+1}for(;h.charCodeAt(n)===32;)n++;if(h.charCodeAt(n)===58){if((i=h.indexOf(" ",n))===-1)return null;for(c.prefix=h.slice(n+1,i),n=i+1;h.charCodeAt(n)===32;)n++}if((i=h.indexOf(" ",n))===-1)return h.length>n?(c.command=h.slice(n),c):null;for(c.command=h.slice(n,i),n=i+1;h.charCodeAt(n)===32;)n++;for(;n<h.length;){if(i=h.indexOf(" ",n),h.charCodeAt(n)===58){c.params.push(h.slice(n+1));break}if(i===-1){if(i===-1){c.params.push(h.slice(n));break}}else for(c.params.push(h.slice(n,i)),n=i+1;h.charCodeAt(n)===32;)n++}return c}}},{"./utils":9}],8:[function(L,x,S){function p(_,g){for(var h=0;h<g.length;h++){var c=g[h];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(_,c.key,c)}}x.exports=function(){function _(c){(function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")})(this,_),this.queue=[],this.index=0,this.defaultDelay=c===void 0?3e3:c}var g,h;return g=_,(h=[{key:"add",value:function(c,n){this.queue.push({fn:c,delay:n})}},{key:"next",value:function(){var c,n=this,i=this.index++,i=this.queue[i];i&&(c=this.queue[this.index],i.fn(),c&&(i=c.delay===void 0?this.defaultDelay:c.delay,setTimeout(function(){return n.next()},i)))}}])&&p(g.prototype,h),_}()},{}],9:[function(L,x,S){(function(p){(function(){function _(s){return(_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(s)}var g,h=/^\u0001ACTION ([^\u0001]+)\u0001$/,c=/^(justinfan)(\d+$)/,n=/\\([sn:r\\])/g,i=/([ \n;\r\\])/g,f={s:" ",n:"",":":";",r:""},e={" ":"s","\n":"n",";":":","\r":"r"},o=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),r=/[|\\^$*+?:#]/,a=x.exports={get:function(s,m){return s===void 0?m:s},hasOwn:function(s,m){return{}.hasOwnProperty.call(s,m)},promiseDelay:function(s){return new Promise(function(m){return setTimeout(m,s)})},isFinite:(g=function(s){return isFinite(s)&&!isNaN(parseFloat(s))},l.toString=function(){return g.toString()},l),toNumber:function(s,m){return s===null?0:(m=Math.pow(10,a.isFinite(m)?m:0),Math.round(s*m)/m)},isInteger:function(s){return!isNaN(a.toNumber(s,0))},isRegex:function(s){return r.test(s)},isURL:function(s){return o.test(s)},justinfan:function(){return"justinfan".concat(Math.floor(8e4*Math.random()+1e3))},isJustinfan:function(s){return c.test(s)},channel:function(s){var m;return(m=(s||"").toLowerCase())[0]==="#"?m:"#"+m},username:function(s){var m;return(m=(s||"").toLowerCase())[0]==="#"?m.slice(1):m},token:function(s){return s?s.toLowerCase().replace("oauth:",""):""},password:function(s){return s=a.token(s),s?"oauth:".concat(s):""},actionMessage:function(s){return s.match(h)},replaceAll:function(s,m){if(s==null)return null;for(var w in m)s=s.replace(new RegExp(w,"g"),m[w]);return s},unescapeHtml:function(s){return s.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'")},unescapeIRC:function(s){return s&&typeof s=="string"&&s.includes("\\")?s.replace(n,function(m,w){return w in f?f[w]:w}):s},escapeIRC:function(s){return s&&typeof s=="string"?s.replace(i,function(m,w){return w in e?"\\".concat(e[w]):w}):s},addWord:function(s,m){return s.length?s+" "+m:s+m},splitLine:function(s,m){var w=s.substring(0,m).lastIndexOf(" ");return[s.substring(0,w=w===-1?m-1:w),s.substring(w+1)]},extractNumber:function(s){for(var m=s.split(" "),w=0;w<m.length;w++)if(a.isInteger(m[w]))return~~m[w];return 0},formatDate:function(w){var m=w.getHours(),w=((w=w.getMinutes())<10?"0":"")+w;return"".concat(m=(m<10?"0":"")+m,":").concat(w)},inherits:function(s,m){s.super_=m;function w(){}w.prototype=m.prototype,s.prototype=new w,s.prototype.constructor=s},isNode:function(){try{return(p===void 0?"undefined":_(p))==="object"&&Object.prototype.toString.call(p)==="[object process]"}catch{}return!1}};function l(s){return g.apply(this,arguments)}}).call(this)}).call(this,L("_process"))},{_process:11}],10:[function(L,x,S){},{}],11:[function(L,g,S){var p,_,g=g.exports={};function h(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function n(m){if(p===setTimeout)return setTimeout(m,0);if((p===h||!p)&&setTimeout)return p=setTimeout,setTimeout(m,0);try{return p(m,0)}catch{try{return p.call(null,m,0)}catch{return p.call(this,m,0)}}}(function(){try{p=typeof setTimeout=="function"?setTimeout:h}catch{p=h}try{_=typeof clearTimeout=="function"?clearTimeout:c}catch{_=c}})();var i,f=[],e=!1,o=-1;function r(){e&&i&&(e=!1,i.length?f=i.concat(f):o=-1,f.length&&a())}function a(){if(!e){var m=n(r);e=!0;for(var w=f.length;w;){for(i=f,f=[];++o<w;)i&&i[o].run();o=-1,w=f.length}i=null,e=!1,function(b){if(_===clearTimeout)return clearTimeout(b);if((_===c||!_)&&clearTimeout)return _=clearTimeout,clearTimeout(b);try{_(b)}catch{try{return _.call(null,b)}catch{return _.call(this,b)}}}(m)}}function l(m,w){this.fun=m,this.array=w}function s(){}g.nextTick=function(m){var w=new Array(arguments.length-1);if(1<arguments.length)for(var b=1;b<arguments.length;b++)w[b-1]=arguments[b];f.push(new l(m,w)),f.length!==1||e||n(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},g.title="browser",g.browser=!0,g.env={},g.argv=[],g.version="",g.versions={},g.on=s,g.addListener=s,g.once=s,g.off=s,g.removeListener=s,g.removeAllListeners=s,g.emit=s,g.prependListener=s,g.prependOnceListener=s,g.listeners=function(m){return[]},g.binding=function(m){throw new Error("process.binding is not supported")},g.cwd=function(){return"/"},g.chdir=function(m){throw new Error("process.chdir is not supported")},g.umask=function(){return 0}},{}]},{},[1]);var ne=document.querySelector("#app");const q=new URLSearchParams(window.location.search);document.querySelector("#stream").value=localStorage.getItem("stream");q.get("stream")!=null&&localStorage.setItem("stream",q.get("stream"));document.querySelector("#maxmessages").value=localStorage.getItem("maxmessages");q.get("maxmessages")!=null&&localStorage.setItem("maxmessages",q.get("maxmessages"));q.get("stream")!=null&&q.get("stream")!=""&&q.get("maxmessages")!=null&&document.querySelector("#prompt").remove();const se=new tmi.Client({connection:{secure:!0,reconnect:!0},channels:[q.get("stream")]});se.connect();var R=0;se.on("clearchat",L=>{ne.innerHTML=""});se.on("messagedeleted",(L,x,S,p)=>{document.getElementById(`message=${p["target-msg-id"]}`).remove()});function he(L,{emotes:x}){if(!x)return L;const S=[];return Object.entries(x).forEach(([_,g])=>{const h=g[0],[c,n]=h.split("-"),i=L.substring(parseInt(c,10),parseInt(n,10)+1);S.push({stringToReplace:i,replacement:`<img src='https://static-cdn.jtvnw.net/emoticons/v2/${_}/animated/dark/1.0' onerror="this.src=src='https://static-cdn.jtvnw.net/emoticons/v1/${_}/1.0'">`})}),S.reduce((_,{stringToReplace:g,replacement:h})=>_.split(g).join(h),L)}se.on("message",(L,x,S,p)=>{console.log(x),console.log(`Message img ${he(S,x)}`),console.log(`${x["display-name"]}: ${S}`);var _=document.createElement("div");_.id=`message=${x.id}`;var g=document.createElement("div");g.classList.add("title-bar"),g.onmousedown=function(m){g.classList.add("active"),g.addEventListener("mousemove",a),r.style.zIndex=R,R=R+1},g.onmouseup=function(m){g.classList.remove("active"),g.removeEventListener("mousemove",a),r.style.zIndex=R,R=R+1},g.onmouseleave=function(m){g.classList.remove("active"),g.removeEventListener("mousemove",a)};var h=document.createElement("div");h.innerHTML=`${x["display-name"]}`,h.classList.add("title-bar-text");var c=document.createElement("div");c.classList.add("title-bar-controls");var n=document.createElement("button");n.ariaLabel="Minimize",c.appendChild(n);var i=document.createElement("button");i.ariaLabel="Maximize",c.appendChild(i);var f=document.createElement("button");f.ariaLabel="Close",f.onclick=function(m){_.remove()},c.appendChild(f),g.appendChild(h),g.appendChild(c);var e=document.createElement("div");e.classList.add("window-body");var o=document.createElement("p");o.innerHTML=` ${he(S,x)} `,e.appendChild(o),_.appendChild(g),_.appendChild(e);var r=ne.appendChild(_);function a({movementX:m,movementY:w}){let b=window.getComputedStyle(r),$=parseInt(b.left),t=parseInt(b.top);r.style.left=`${$+m}px`,r.style.top=`${t+w}px`}var l=Math.floor(Math.random()*window.innerHeight),s=Math.floor(Math.random()*window.innerWidth);s<window.innerWidth+250&&s>250&&(s=s-250),l>window.innerHeight-_.clientHeight&&(l=l-_.clientHeight),r.classList.add("window"),r.style.width="250px",r.style.position="fixed",r.style.right=s+"px",r.style.top=l+"px",r.style.zIndex=R,r.onclick=function(m){console.log(m),r.style.zIndex=R,R=R+1},R=R+1,ne.children.length>q.get("maxmessages")&&ne.children[0].remove()});
